/* fromone 2015-03-05  by yansm*/
var USERSTATUS={islogin:!1},APP_ID="cyrCA2YHb",APP_KEY="5c81636378414a40b658c06b10d10f34",REDIRECT_URL="http://yansm.github.io/fromone/checkOAUTH.html",TOKEN="",REACT_COMMENT={};Date.prototype.format=function(a){var b={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(a)&&(a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var c in b)new RegExp("("+c+")").test(a)&&(a=a.replace(RegExp.$1,1==RegExp.$1.length?b[c]:("00"+b[c]).substr((""+b[c]).length)));return a},$.extend({getUrlVars:function(){for(var a,b=[],c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),d=0;d<c.length;d++)a=c[d].split("="),b.push(a[0]),b[a[0]]=a[1];return b},getUrlVar:function(a){return $.getUrlVars()[a]},getRootPath:function(){var a=window.document.location.href,b=window.document.location.pathname,c=a.indexOf(b),d=a.substring(0,c),e=b.substring(0,b.substr(1).indexOf("/")+1);return d+e},setUrlWidthVars:function(a,b){var c=b+"/"+a.url+".html";return c},loadImg:function(b,c,d,e){function f(a,f){var i=new Image;i.onload=function(){g++,c&&c(g,b.length,a,f),d&&g==b.length&&d(h)},i.onerror=function(){g++,h++,e&&e(g,b.length,a,f)},i.src=a}var g=0,h=0,i="[object Object]"===Object.prototype.toString.call(b)?!0:!1,b=i?b.get():b;for(a in b){var j=i?$(b[a]).attr("data-src"):b[a];f(j,b[a])}},getRndNum:function(a){for(var b=[],c=0;a>c;c++)b.push(Math.floor(4*Math.random()+1));return b},getToken:function(){var a=$.getUrlVar("code");$.ajax({data:{code:a,client_id:APP_ID,client_secret:APP_KEY,grant_type:"authorization_code",redirect_uri:REDIRECT_URL},url:"https://changyan.sohu.com/api/oauth2/token",type:"post",success:function(a){var b=a.access_token;parent.$.getUser(b)},erroe:function(a){console.debug(a)}})},getUser:function(a){TOKEN=a,$.ajax({data:{access_token:a,client_id:APP_ID},url:"http://changyan.sohu.com/api/2/user/info",type:"get",dataType:"JSONP",success:function(a){USERSTATUS={islogin:!0,data:a},$.closeModal()},error:function(a){console.debug(a)}})},openModal:function(a,b){$(".modal-area").eq(0).find(".modal-box").html(a).end().show(function(){$(this).addClass("current")}).data("flag",b)},closeModal:function(){$(".modal-area").eq(0).find(".modal-box").html("").end().removeClass("current"),setTimeout(function(){$(".modal-area").eq(0).hide();var a=$(".modal-area").data("flag");a&&REACT_COMMENT[a]&&REACT_COMMENT[a].takeUser&&REACT_COMMENT[a].takeUser()},500)}}),$(function(){var a=$("body"),b=$(".full-screen"),c=$(".loading-area"),d={level:1,type:"bottom",model:"index",url:"index"},e=$.getRootPath(),f=[e+"/images/index-background.jpg",e+"/images/phrase-background.jpg",e+"/images/about-background.jpg",e+"/images/css-background.jpg"],g=function(c){a.removeClass().addClass(c),b.show(),setTimeout(function(){b.addClass("current")},100)},h=function(){b.removeClass("current"),setTimeout(function(){b.hide()},1370)};$(document).on("click",'[click-target="change-btn"]',function(){var a=$(this),b=a.data();i(b)}).on("click",'[click-target="page-btn"]',function(){var a=$.extend({},{level:"2",type:"page"},$(this).data());i(a)}).on("click",".modal-area",function(){$.closeModal()}).on("click",".modal-box",function(a){a.stopPropagation()});var i=function(a,b){a&&a.level&&a.type&&a.model||(a=d);var c=$.setUrlWidthVars(a,e);return b?void history.replaceState(a,"",c):(history.pushState(a,"",c),void k(a))};window.addEventListener("popstate",function(a){k(a.state)});var j=function(){},k=function(b){var c=a.data(),e=b;c&&c.level&&c.type&&c.model||(c=d),e&&e.level&&e.type&&e.model||(e=d);var f=c.level,g=e.level;if(f!=g||c.model!=e.model){var h="hide";f>g?h="down":g>f&&(h="up");var i=$.Event(h+"."+c.type+"."+c.model+".level_"+f,{l_state:c,n_state:e});console.debug(h+"."+c.type+"."+c.model+".level_"+f),a.trigger(i)}},l=function(b,c,d){var e=c.type,f=c.model,d=d+100;0==$("#"+e).length&&a.append("<div id="+e+"></div>"),$("#"+e).show().load(f+".html ."+f+"-area",function(b,g){if("error"==g)return void j();var i=$(this);"bottom"==e&&(d+=1500,h()),setTimeout(function(){i.find("."+f+"-area").addClass("current"),o[f]&&o[f](),a.data(c)},d)})},m=function(c,d,e){var f=c.type,h=c.model,e=e;b.hasClass("current")||(g(d.model),e+=1500),a.find("."+h+"-area").removeClass("current"),setTimeout(function(){var b=$.Event("show."+d.type+"."+d.model+".level_"+d.level,{l_state:c,n_state:d});console.debug("show."+d.type+"."+d.model+".level_"+d.level),$("#"+f).hide(),a.trigger(b)},e)},n=function(b,c,d){{var f=b.model,d=d,g=c.model,h=c.type;c.url}$("."+f+"-area").addClass("page-current"),0==$("#"+h).length&&a.append("<div id="+h+' style="display:block;"></div>'),setTimeout(function(){console.debug(g),$("#"+h).addClass("page-"+g).load($.setUrlWidthVars(c,e)+" ."+g+"-area",function(b,d){if("error"==d)return void j();var e=$(this);setTimeout(function(){e.find("."+g+"-area").addClass("current"),a.data(c)},100);var f=$.Event("upn."+g);a.trigger(f)})},d)};a.on("show.bottom.index.level_1",function(a){var b=0;l(a.l_state,a.n_state,b)}).on("hide.bottom.index.level_1",function(a){var b=0;m(a.l_state,a.n_state,b)}).on("up.bottom.index.level_1",function(a){var b=0;n(a.l_state,a.n_state,b)}).on("upn.index-page",function(){REACT_COMMENT.theLWComment=React.render(React.createElement(LeaveWordComment,{}),$(".index-page-area")[0])}).on("show.top.essay.level_1",function(a){var b=0;l(a.l_state,a.n_state,b)}).on("hide.top.essay.level_1",function(a){var b=500;m(a.l_state,a.n_state,b)}).on("show.bottom.css.level_1",function(a){var b=0;l(a.l_state,a.n_state,b)}).on("hide.bottom.css.level_1",function(a){var b=0;m(a.l_state,a.n_state,b)}).on("show.bottom.phrase.level_1",function(a){var b=0;l(a.l_state,a.n_state,b)}).on("hide.bottom.phrase.level_1",function(a){var b=0;m(a.l_state,a.n_state,b)}).on("show.bottom.about.level_1",function(a){var b=0;l(a.l_state,a.n_state,b)}).on("hide.bottom.about.level_1",function(a){var b=0;m(a.l_state,a.n_state,b)});var o={essay:function(){$(".essay-area").jScrollPane()}},p=a.data();$("."+p.model+"-area").addClass("current"),o[p.model]&&o[p.model](),"top"==p.type&&g(p.model),$.loadImg(f,$.noop,function(){},$.noop),window.onload=function(){c.addClass("current"),setTimeout(function(){c.hide()},1e3)}});