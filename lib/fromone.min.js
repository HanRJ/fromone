/* fromone 2015-03-10  by yansm*/
var USERSTATUS={islogin:!1},APP_ID="cyrCA2YHb",APP_KEY="5c81636378414a40b658c06b10d10f34",REDIRECT_URL="http://yansm.github.io/fromone/checkOAUTH.html",TOKEN="",REACT_COMMENT={};Date.prototype.format=function(a){var b={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(a)&&(a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var c in b)new RegExp("("+c+")").test(a)&&(a=a.replace(RegExp.$1,1==RegExp.$1.length?b[c]:("00"+b[c]).substr((""+b[c]).length)));return a},$.extend({getUrlVars:function(){for(var a,b=[],c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),d=0;d<c.length;d++)a=c[d].split("="),b.push(a[0]),b[a[0]]=a[1];return b},getUrlVar:function(a){return $.getUrlVars()[a]},getRootPath:function(){var a=window.document.location.href,b=window.document.location.pathname,c=a.indexOf(b),d=a.substring(0,c),e=b.substring(0,b.substr(1).indexOf("/")+1);return d+e},cookie:function(a,b){if("object"!=typeof a){for(var c=document.cookie.split(";"),d="",e=0;e<c.length;e++){var f=c[e].split("=");f[0]==a&&(d=unescape(f[1]));break}return d}for(key in a){var g=new Date;g.setTime(g.getTime()+b),document.cookie=escape(key)+"="+escape(a[key])+";expires="+g.toGMTString()}},setUrlWidthVars:function(a,b){var c=b+"/"+a.url+".html";return c},loadImg:function(b,c,d,e){function f(a,f){var i=new Image;i.onload=function(){g++,c&&c(g,b.length,a,f),d&&g==b.length&&d(h)},i.onerror=function(){g++,h++,e&&e(g,b.length,a,f)},i.src=a}var g=0,h=0,i="[object Object]"===Object.prototype.toString.call(b)?!0:!1,b=i?b.get():b;for(a in b){var j=i?$(b[a]).attr("data-src"):b[a];f(j,b[a])}},getRndNum:function(a){for(var b=[],c=0;a>c;c++)b.push(Math.floor(4*Math.random()+1));return b},getToken:function(){var a=$.getUrlVar("code");$.ajax({data:{code:a,client_id:APP_ID,client_secret:APP_KEY,grant_type:"authorization_code",redirect_uri:REDIRECT_URL},url:"https://changyan.sohu.com/api/oauth2/token",type:"post",success:function(a){parent.$.setToken(a)},erroe:function(a){console.debug(a)}})},setToken:function(a){$.cookie({fromone_token:a.access_token},a.expires_in),$.setUser(),$.closeModal();var b="theComment";REACT_COMMENT[b]&&REACT_COMMENT[b].takeUser&&REACT_COMMENT[b].takeUser()},setUser:function(){token=$.cookie("fromone_token"),token||(USERSTATUS={islogin:!1,data:{}}),$.ajax({data:{access_token:token,client_id:APP_ID},sync:!1,url:"http://changyan.sohu.com/api/2/user/info",type:"get",dataType:"JSONP",success:function(a){return USERSTATUS={islogin:!0,data:a},console.debug("#"),console.debug(USERSTATUS),USERSTATUS},error:function(a){console.debug(a)}})},openModal:function(a){$(".modal-area").eq(0).find(".modal-box").html(a).end().show(function(){$(this).addClass("current")})},closeModal:function(){$(".modal-area").eq(0).find(".modal-box").html("").end().removeClass("current"),setTimeout(function(){$(".modal-area").eq(0).hide()},500)}}),$(function(){var a=$("body"),b=$(".full-screen"),c=$(".loading-area"),d={level:1,type:"bottom",model:"index",url:"index"},e=$.getRootPath(),f=[e+"/images/index-background.jpg",e+"/images/phrase-background.jpg",e+"/images/about-background.jpg",e+"/images/css-background.jpg"],g=function(c){a.removeClass().addClass(c),b.show(),setTimeout(function(){b.addClass("current")},100)},h=function(){b.removeClass("current"),setTimeout(function(){b.hide()},1370)};$(document).on("click",'[click-target="change-btn"]',function(){var a=$.extend({},{level:"1"},$(this).data());i(a)}).on("click",'[click-target="page-btn"]',function(){var a=$.extend({},{level:"2"},$(this).data());i(a)}).on("click",".modal-area",function(){$.closeModal()}).on("click",".modal-box",function(a){a.stopPropagation()});var i=function(a,b){a&&a.level&&a.model||(a=d);var c=$.setUrlWidthVars(a,e);return b?void history.replaceState(a,"",c):(history.pushState(a,"",c),void k(a))};window.addEventListener("popstate",function(a){k(a.state)});var j=function(){},k=function(b){var c=a.data(),e=b;c&&c.level&&c.model||(c=d),e&&e.level&&e.model||(e=d);var f=c.level,g=e.level;if(f!=g||c.model!=e.model){var h="hide";c.type=e.type="bottom",f>g?(h="down",c.type="page"):g>f&&(h="up",e.type="page");var i=$.Event(h+"."+c.model,{l_state:c,n_state:e});console.debug(h+"."+c.model),a.trigger(i)}},l=function(b,c,d){var e=c.type,f=c.model,d=d+100;0==$("#"+e).length&&a.append("<div id="+e+"></div>"),$("#"+e).show().load(f+".html ."+f+"-area",function(b,g){if("error"==g)return void j();var i=$(this);"bottom"==e&&(d+=1500,h()),setTimeout(function(){i.find("."+f+"-area").addClass("current");var b=$.Event("done."+f);a.data(c).trigger(b)},d)})},m=function(c,d,e){var f=c.type,h=c.model,e=e;b.hasClass("current")||(g(d.model),e+=1500),a.find("."+h+"-area").removeClass("current"),setTimeout(function(){var b=$.Event("show."+d.model,{l_state:c,n_state:d});console.debug("show."+d.model),$("#"+f).hide(),a.trigger(b)},e)},n=function(b,c,d){{var f=b.model,d=d,g=c.model,h=c.type;c.url}$("."+f+"-area").addClass("page-current"),0==$("#"+h).length&&a.append("<div id="+h+' style="display:block;"></div>'),setTimeout(function(){$("#"+h).show().addClass("page-"+g).load($.setUrlWidthVars(c,e)+" ."+g+"-area",function(b,d){if(console.debug(d),"error"==d)return void j();var e=$(this);setTimeout(function(){e.find("."+g+"-area").addClass("current"),a.data(c)},100);var f=$.Event("done."+g);a.trigger(f)})},d)},o=function(b,c,d){{var f=b.model,g=b.type,d=d,h=c.model,i=c.type;c.url}$("#"+g).find("."+f+"-area").removeClass("current").end().delay(1e3).hide(0),0==$("#"+i).length&&a.append("<div id="+i+' style="display:block;"></div>'),setTimeout(function(){$("#"+i).find(" ."+h+"-area").length>0?$("#"+i).find(" ."+h+"-area").removeClass("page-current"):$("#"+i).addClass(h).load($.setUrlWidthVars(c,e)+" ."+h+"-area",function(b,d){if("error"==d)return void j();var e=$(this);e.find("."+h+"-area").addClass("current");var f=$.Event("done."+h);a.data(c).trigger(f)}),a.data(c)},d)},p=function(){var a=_.filter(post_map,function(a){return a.catgory?a.catgory.match("essay"):!1});return a},q={};q.essay=function(){for(var a=p("essay"),b=[],c=a.length,d=c-1;d>=0;d--){var e=a[d],f=e.time.split("-");b.push('<div class="article-box"><hgroup><h3 class="article-title">'),b.push(e.title),b.push('</h3><aside><span class="article-time"><i class="year">'),b.push(f[0]),b.push('</i><i class="month">'),b.push(f[1]),b.push('</i><i class="day">'),b.push(f[2]),b.push('</i></span><span class="article-author">'),b.push(e.author),b.push('</span></aside></hgroup><div class="article-intro">'),b.push(e.intro),b.push('</div><div class="article-more" click-target="page-btn" data-model="essay-page"  data-url="'+e.dest+'">read more</div></div>')}$(".essay-list").append(b.join(""))},a.on("show.index",function(a){var b=0;l(a.l_state,a.n_state,b)}).on("hide.index",function(a){var b=0;m(a.l_state,a.n_state,b)}).on("up.index",function(a){var b=0;n(a.l_state,a.n_state,b)}).on("down.index-page",function(a){var b=0;o(a.l_state,a.n_state,b)}).on("done.index-page",function(){REACT_COMMENT.theComment=React.render(React.createElement(LeaveWordComment,{}),$(".index-page-container")[0])}).on("show.essay",function(a){var b=0,c=a.n_state;c.type="top",l(a.l_state,c,b)}).on("hide.essay",function(a){var b=500,c=a.l_state;c.type="top",m(c,a.n_state,b)}).on("up.essay",function(a){var b=0;n(a.l_state,a.n_state,b)}).on("down.essay-page",function(a){var b=0,c=a.n_state;c.type="top",o(a.l_state,c,b)}).on("done.essay",function(){q.essay(),$(".essay-area").jScrollPane()}).on("done.essay-page",function(){g("essay")}).on("show.css",function(a){var b=0;l(a.l_state,a.n_state,b)}).on("hide.css",function(a){var b=0;m(a.l_state,a.n_state,b)}).on("show.phrase",function(a){var b=0;l(a.l_state,a.n_state,b)}).on("hide.phrase",function(a){var b=0;m(a.l_state,a.n_state,b)}).on("show.about",function(a){var b=0;l(a.l_state,a.n_state,b)}).on("hide.about",function(a){var b=0;m(a.l_state,a.n_state,b)});var r=a.data();$("."+r.model+"-area").addClass("current");var s=$.Event("done."+r.model);a.trigger(s),"top"==r.type&&g(r.model),$.loadImg(f,$.noop,function(){},$.noop),window.onload=function(){c.addClass("current"),setTimeout(function(){c.hide()},1e3)}});